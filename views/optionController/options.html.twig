{% extends "dashboard.html.twig" %}
{% block title %}
	{{ parent() }}
	Options
{% endblock %}
{% block content %}
	{% do clear_session_alert() %}

	{% include 'components/dashboard/header.html.twig' with {'title': 'Options'} %}
	<div class="flex-1 p-6 bg-gray-50 h-[calc(100vh-5.1rem)] w-full overflow-y-auto overflow-x-scroll">
		{% if session.alert and session.alert.context == 'global' %}
			<div class="text-sm mb-6 {% if session.alert.status == 'error' %}text-danger{% else %}text-success{% endif %}">
				{{ session.alert.message }}
			</div>
		{% endif %}
		<div class="flex flex-col gap-6 overflow-x-scroll h-full">
			<div class="overflow-x-auto overflow-y-visible h-full">
				<div class="inline-block min-w-full align-middle">
					<div class="bg-white border border-gray-200 rounded-xl">

						<div class="px-4 py-3 grid gap-4 sm:flex sm:justify-between sm:items-center border-b border-gray-200">
							<div>
								<h2 class="text-xl font-medium">
									Options
								</h2>
								<p class="text-sm text-gray-500">
									Consultez et gérez vos options.
								</p>
							</div>

							<div>
								<div class="inline-flex gap-x-2">
									<button class="py-2 px-3 inline-flex items-center gap-x-2 text-sm font-medium rounded-lg text-white bg-primary hover:bg-primary/90 focus:outline-hidden focus:bg-primary/90 disabled:opacity-50 disabled:pointer-events-none transition duration-300 open-modal" data-modal-target="create-option">
										Créer une option
									</button>
								</div>
							</div>
						</div>

						<div class="w-full">
							<table class="w-full divide-y divide-gray-200">
								<thead class="bg-gray-50">
									<tr>
										<th scope="col" class="px-3 py-2 text-start">
											<span class="text-xs font-semibold uppercase truncate">
												ID
											</span>
										</th>

										<th scope="col" class="px-3 py-2 text-start">
											<span class="text-xs font-semibold uppercase truncate">
												Nom
											</span>
										</th>
										<th scope="col" class="px-3 py-2 text-start">
											<span class="text-xs font-semibold uppercase truncate">
												Prix
											</span>
										</th>
										<th scope="col" class="px-3 py-3 text-end"></th>
									</tr>
								</thead>

								<tbody class="divide-y divide-gray-200">
									{% if options is empty %}
										<tr class="bg-white hover:bg-gray-50">
											<td colspan="4" class="px-3 py-3 whitespace-nowrap text-center">
												<span class="text-sm text-gray-500 truncate block">Aucune option</span>
											</td>
										</tr>
									{% endif %}
									{% for option in options %}
										<tr class="bg-white hover:bg-gray-50">
											<td class="px-3 py-3 whitespace-nowrap">
												<span class="text-sm text-gray-500 truncate block">{{ option.id }}</span>
											</td>
											<td class="px-3 py-3 whitespace-nowrap">
												<span class="text-sm text-gray-500 truncate block">{{ option.name }}</span>
											</td>
											<td class="px-3 py-3 whitespace-nowrap">
												<span class="text-sm text-gray-500 truncate block">{{ option.price }}
													€</span>
											</td>

											<td class="px-3 py-3 whitespace-nowrap text-end">
												<div class="relative inline-flex">
													<button type="button" class="py-1.5 px-1.5 border text-xs rounded-lg font-medium bg-gray-50 hover:bg-white focus:outline-hidden transition-all" data-dropdown-trigger data-target="option-actions-{{ option.id }}" aria-expanded="false">
														<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewbox="0 0 24 24" stroke="currentColor">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"/>
														</svg>
													</button>
													<div data-dropdown="option-actions-{{ option.id }}" class="absolute right-0 mt-2 w-48 bg-white rounded-xl shadow-lg border border-gray-200 opacity-0 invisible translate-y-2 transition-all duration-300 z-20">
														<div class="p-2">
															<a href="/dashboard/options/edit/{{ option.id }}" class="px-4 py-2 text-sm text-gray-500 hover:bg-gray-50 rounded-lg transition-all flex items-center gap-2">
																<svg class="h-4 w-4 flex-shrink-0 fill-gray-500" height="800px" width="800px" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewbox="0 0 512 512" xml:space="preserve">
																	<path d="M311.18,78.008L32.23,356.958L0.613,485.716c-1.771,7.209,0.355,14.818,5.604,20.067 c5.266,5.266,12.88,7.368,20.067,5.604l128.759-31.617l278.95-278.95L311.18,78.008z M40.877,471.123l10.871-44.271l33.4,33.4 L40.877,471.123z"/>
																	<path d="M502.598,86.818L425.182,9.402c-12.536-12.536-32.86-12.536-45.396,0l-30.825,30.825l122.812,122.812l30.825-30.825 C515.134,119.679,515.134,99.354,502.598,86.818z"/>
																</svg>
																<span class="overflow-hidden whitespace-nowrap truncate">Modifier</span>
															</a>
															<button class="w-full px-4 py-2 text-sm text-danger hover:bg-danger/10 rounded-lg transition-all flex items-center gap-2 open-modal" data-modal-target="delete-option-{{ option.id }}">
																<svg class="h-4 w-4 flex-shrink-0 fill-danger" width="800px" height="800px" viewbox="0 0 56 56" xmlns="http://www.w3.org/2000/svg"><path d="M 11.6406 14.6641 L 13.1406 48.9062 C 13.2578 51.8359 15.0156 53.4297 17.8984 53.4297 L 38.125 53.4297 C 41.0078 53.4297 42.7656 51.8359 42.8828 48.9062 L 44.3828 14.6641 L 47.0781 14.6641 C 48.0391 14.6641 48.8125 13.8672 48.8125 12.9063 C 48.8125 11.9453 48.0391 11.1250 47.0781 11.1250 L 37.4453 11.1250 L 37.4453 7.7734 C 37.4453 4.5625 35.3125 2.5703 32.2891 2.5703 L 23.6640 2.5703 C 20.6406 2.5703 18.5313 4.5625 18.5313 7.7734 L 18.5313 11.1250 L 8.9453 11.1250 C 8.0078 11.1250 7.1875 11.9453 7.1875 12.9063 C 7.1875 13.8672 8.0078 14.6641 8.9453 14.6641 Z M 21.7187 7.7734 C 21.7187 6.4375 22.7031 5.5000 24.1094 5.5000 L 31.8672 5.5000 C 33.2969 5.5000 34.2813 6.4375 34.2813 7.7734 L 34.2813 11.1250 L 21.7187 11.1250 Z M 35.6172 48.6484 C 34.7031 48.6484 34.0703 47.8516 34.0938 46.8906 L 35.0547 19.7031 C 35.1016 18.7656 35.7813 17.9922 36.625 17.9922 C 37.4922 17.9922 38.1953 18.7422 38.1719 19.7031 L 37.1172 46.9141 C 37.0938 47.9219 36.4844 48.6484 35.6172 48.6484 Z M 20.4062 48.6484 C 19.5391 48.6484 18.9297 47.9219 18.9062 46.9141 L 17.8516 19.7031 C 17.8281 18.7187 18.5313 17.9922 19.3984 17.9922 C 20.2422 17.9922 20.9453 18.7656 20.9687 19.7031 L 21.9297 46.8906 C 21.9531 47.8516 21.3203 48.6484 20.4062 48.6484 Z M 29.6172 46.8906 C 29.6172 47.8516 28.8672 48.6484 28.0234 48.6484 C 27.1797 48.6484 26.4297 47.8516 26.4297 46.8906 L 26.4297 19.7031 C 26.4297 18.7656 27.1797 17.9922 28.0234 17.9922 C 28.8672 17.9922 29.6406 18.7656 29.6406 19.7031 Z"/></svg>
																<span class="overflow-hidden whitespace-nowrap truncate">Supprimer</span>
															</button>
														</div>
													</div>
												</div>
											</td>
										</tr>
										<div data-modal="delete-option-{{ option.id }}" class="fixed inset-0 z-50 hidden modal">
											<div class="absolute inset-0 bg-black/80 opacity-0 transition-opacity duration-300 modal-backdrop"></div>
											<div class="relative z-10 h-full w-full flex items-center justify-center pointer-events-none opacity-0 transform scale-95 transition-all duration-300 modal-content">
												<div class="max-h-[75vh] max-w-7xl w-full mx-6 bg-white rounded-2xl overflow-y-scroll pointer-events-auto p-6 flex flex-col gap-6">
													<h2 class="text-xl font-medium">
														Supprimer l'option
														{{ option.name }}
													</h2>
													<p class="text-sm text-gray-500">
														Êtes-vous sûr de vouloir supprimer cette option ? Cette action est irréversible.
													</p>
													<div class="flex justify-end gap-x-2">
														<button type="button" class="border py-2 px-4 text-sm font-medium text-gray-500 bg-white hover:bg-gray-50 focus:outline-hidden transition-all rounded-lg modal-close">Annuler</button>
														<form action="/dashboard/options/delete/{{ option.id }}" method="post">
															<button type="submit" class="py-2 px-4 text-sm bg-danger hover:bg-danger/90 font-medium text-white focus:outline-hidden transition-all rounded-lg">Supprimer</button>
														</form>
													</div>
												</div>
											</div>
										</div>
									{% endfor %}
								</tbody>
							</table>
						</div>
						<div class="px-4 py-3 grid gap-2 md:flex md:justify-between md:items-center border-t border-gray-200">
							<div>
								<p class="text-sm text-gray-500">
									<span class="font-medium">{{ options|length }}</span>
									option(s)
								</p>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div data-modal="create-option" class="fixed inset-0 z-50 hidden modal">
			<div class="absolute inset-0 bg-black/80 opacity-0 transition-opacity duration-300 modal-backdrop"></div>
			<div class="relative z-10 h-full w-full flex items-center justify-center pointer-events-none opacity-0 transform scale-95 transition-all duration-300 modal-content">
				<form action="/dashboard/options/add" method="post" class="group max-w-7xl w-full max-h-[75vh] mx-6 bg-gray-50 rounded-2xl overflow-y-scroll pointer-events-auto p-6 flex flex-col gap-6">
					<h2 class="text-xl font-medium">
						Créer une option
					</h2>
					{% if session.alert and session.alert.context == 'modal' %}
						<div class="text-sm {% if session.alert.status == 'error' %}text-danger{% else %}text-success{% endif %}">
							{{ session.alert.message }}
						</div>
					{% endif %}
					<div class="grid grid-cols-1 gap-6">
						<div class="flex flex-col gap-2 relative">
							<label for="name" class="font-medium text-sm">Nom</label>
							<input minlength="1" maxlength="50" oninput="this.classList.remove('invalid')" type="text" id="name" name="name" placeholder="Nom de l'option" class="peer block py-4 px-4 m-0 w-full rounded-xl border border-gray-200 border-solid appearance-none text-sm sm:leading-5 focus:border-primary focus:ring-primary focus:outline-offset-2 [.invalid]:border-danger [.invalid]:ring-danger [.invalid]:ring-1 [&:not(:placeholder-shown):not(:focus):invalid]:border-danger [&:not(:placeholder-shown):not(:focus):invalid]:ring-danger [&:not(:placeholder-shown):not(:focus):invalid]:ring-1 {% if session.alert.errors.name %} invalid {% endif %}" required>
							{% if session.alert.errors.name %}
								<span class="mt-2 hidden text-xs text-danger peer-[.invalid]:block">
									{{ session.alert.errors.name }}
								</span>
							{% endif %}
						</div>

						<div class="flex flex-col gap-2 relative">
							<label for="description" class="font-medium text-sm">Description</label>
							<textarea minlength="10" maxlength="255" oninput="this.classList.remove('invalid')" id="description" name="description" placeholder="Description de l'option" class="peer block py-4 px-4 m-0 w-full rounded-xl border border-gray-200 border-solid appearance-none text-sm sm:leading-5 focus:border-primary focus:ring-primary focus:outline-offset-2 [.invalid]:border-danger [.invalid]:ring-danger [.invalid]:ring-1 [&:not(:placeholder-shown):not(:focus):invalid]:border-danger [&:not(:placeholder-shown):not(:focus):invalid]:ring-danger [&:not(:placeholder-shown):not(:focus):invalid]:ring-1 {% if session.alert.errors.description %} invalid {% endif %}" required></textarea>
							{% if session.alert.errors.description %}
								<span class="mt-2 hidden text-xs text-danger peer-[.invalid]:block">
									{{ session.alert.errors.description }}
								</span>
							{% endif %}
						</div>

						<div class="grid grid-cols-1 md:grid-cols-2 gap-6">
							<div class="flex flex-col gap-2 relative">
								<label for="price" class="font-medium text-sm">Prix</label>
								<input oninput="this.classList.remove('invalid')" type="number" min="0" step="0.01" id="price" name="price" placeholder="Prix" class="peer block py-4 px-4 m-0 w-full rounded-xl border border-gray-200 border-solid appearance-none text-sm sm:leading-5 focus:border-primary focus:ring-primary focus:outline-offset-2 [.invalid]:border-danger [.invalid]:ring-danger [.invalid]:ring-1 {% if session.alert.errors.price %} invalid {% endif %}" required>
								{% if session.alert.errors.price %}
									<span class="mt-2 hidden text-xs text-danger peer-[.invalid]:block">
										{{ session.alert.errors.price }}
									</span>
								{% endif %}
							</div>

							<div class="flex flex-col gap-2 relative">
								<label for="tva" class="font-medium text-sm">TVA</label>
								<input oninput="this.classList.remove('invalid')" type="number" min="0" max="100" id="tva" name="tva" placeholder="TVA" class="peer block py-4 px-4 m-0 w-full rounded-xl border border-gray-200 border-solid appearance-none text-sm sm:leading-5 focus:border-primary focus:ring-primary focus:outline-offset-2 [.invalid]:border-danger [.invalid]:ring-danger [.invalid]:ring-1 {% if session.alert.errors.tva %} invalid {% endif %}">
								{% if session.alert.errors.tva %}
									<span class="mt-2 hidden text-xs text-danger peer-[.invalid]:block">
										{{ session.alert.errors.tva }}
									</span>
								{% endif %}
							</div>
						</div>

						<div class="flex flex-col gap-2 relative">
							<label for="image_id" class="font-medium text-sm">Image</label>
							{% if images is empty %}
								<div class="gap-x-2 items-center flex">
									<svg class="block flex-shrink-0 w-4 h-4 align-middle" width="800px" height="800px" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
										<path id="Vector" d="M12 11V16M12 21C7.02944 21 3 16.9706 3 12C3 7.02944 7.02944 3 12 3C16.9706 3 21 7.02944 21 12C21 16.9706 16.9706 21 12 21ZM12.0498 8V8.1L11.9502 8.1002V8H12.0498Z" stroke="#6b7280" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
									</svg>
									<p class="text-xs text-gray-500">
										Il n'y a aucune image disponible. Vous pouvez ajouter des images sur la page
										<a href="/dashboard/images" class="text-primary hover:underline decoration-2 underline-offset-2">Images</a>.
									</p>
								</div>
							{% else %}
								<div class="grid grid-cols-2 sm:grid-cols-4 md:grid-cols-6 gap-4 bg-white rounded-2xl border p-4 max-h-96 overflow-y-scroll">
									{% for image in images %}
										<label for="image-{{ image.id }}" class="overflow-hidden cursor-pointer h-32 w-full border bg-white rounded-xl border-gray-200 border-solid flex flex-col relative has-checked:ring-primary has-checked:ring-offset-3 has-checked:ring-3">
											<div class="flex flex-col gap-2 p-2 items-start">
												<div class="flex justify-between w-full items-center truncate gap-2">
													<h3 class="text-xs font-medium flex items-center truncate">
														<span class="truncate">{{ image.name }}</span>
													</h3>
													<input type="radio" name="image_id" value="{{ image.id }}" class="focus:ring-primary checked:border-0 focus:outline-hidden inline-block flex-shrink-0 p-0 m-0 w-5 h-5 text-primary align-middle rounded-full border border-gray-300 border-solid appearance-none bg-origin-border focus:outline-offset-2" id="image-{{ image.id }}">
												</div>
											</div>
											<img src="{{ asset('/upload/' ~ image.fileKey ~ '.' ~ image.extension ) }}" alt="{{ image.name }}" class="mt-auto h-full w-full object-cover border-t border-gray-200">
										</label>
									{% endfor %}
								</div>
							{% endif %}
							{% if session.alert.errors.image_id %}
								<span class="mt-2 text-xs text-danger">
									{{ session.alert.errors.image_id }}
								</span>
							{% endif %}
						</div>

						<div class="flex flex-col gap-2">
							<span class="font-medium text-sm">Application de l'option</span>
							<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
								<div class="flex items-center gap-2">
									<input type="checkbox" id="per_adult" name="per_adult" class="focus:ring-primary checked:border-0 focus:outline-hidden inline-block flex-shrink-0 p-0 m-0 w-5 h-5 text-primary align-middle rounded-md border border-gray-300 border-solid appearance-none bg-origin-border focus:outline-offset-2">
									<label for="per_adult" class="text-sm">Par adulte</label>
								</div>
								<div class="flex items-center gap-2">
									<input type="checkbox" id="per_child" name="per_child" class="focus:ring-primary checked:border-0 focus:outline-hidden inline-block flex-shrink-0 p-0 m-0 w-5 h-5 text-primary align-middle rounded-md border border-gray-300 border-solid appearance-none bg-origin-border focus:outline-offset-2">
									<label for="per_child" class="text-sm">Par enfant</label>
								</div>
								<div class="flex items-center gap-2">
									<input type="checkbox" id="per_night" name="per_night" class="focus:ring-primary checked:border-0 focus:outline-hidden inline-block flex-shrink-0 p-0 m-0 w-5 h-5 text-primary align-middle rounded-md border border-gray-300 border-solid appearance-none bg-origin-border focus:outline-offset-2">
									<label for="per_night" class="text-sm">Par nuit</label>
								</div>
								<div class="flex items-center gap-2">
									<input type="checkbox" id="per_quantity" name="per_quantity" class="focus:ring-primary checked:border-0 focus:outline-hidden inline-block flex-shrink-0 p-0 m-0 w-5 h-5 text-primary align-middle rounded-md border border-gray-300 border-solid appearance-none bg-origin-border focus:outline-offset-2" onclick="document.getElementById('quantity_fields').style.display = this.checked ? 'grid' : 'none';">
									<label for="per_quantity" class="text-sm">Par quantité</label>
								</div>
							</div>
						</div>

						<div class="grid grid-cols-1 md:grid-cols-2 gap-6" id="quantity_fields" style="display: none;">
							<div class="flex flex-col gap-2 relative">
								<label for="max_quantity" class="font-medium text-sm">Quantité maximum</label>
								<input type="number" min="0" id="max_quantity" name="max_quantity" placeholder="Quantité maximum" class="peer block py-4 px-4 m-0 w-full rounded-xl border border-gray-200 border-solid appearance-none text-sm sm:leading-5 focus:border-primary focus:ring-primary focus:outline-offset-2">
							</div>

							<div class="flex flex-col gap-2 relative">
								<label for="quantity_identifier" class="font-medium text-sm">Identifiant de quantité</label>
								<input type="text" id="quantity_identifier" name="quantity_identifier" placeholder="Ex: personnes, bouteilles..." class="peer block py-4 px-4 m-0 w-full rounded-xl border border-gray-200 border-solid appearance-none text-sm sm:leading-5 focus:border-primary focus:ring-primary focus:outline-offset-2">
							</div>
						</div>
					</div>
					<div class="group-[&:has(input.invalid)]:cursor-not-allowed group-invalid:cursor-not-allowed flex flex-col items-center gap-2">
						<button class="group-[&:has(input.invalid)]:pointer-events-none group-[&:has(input.invalid)]:bg-primary/50 group-invalid:pointer-events-none group-invalid:bg-primary/50 h-14 inline-flex text-sm items-center justify-center py-4 px-6 text-white font-medium font-heading rounded-xl bg-primary w-full text-center focus:ring focus:ring-primary transition duration-200 hover:bg-primary/95" type="submit">
							Créer une option
						</button>
					</div>
				</form>
			</div>
		</div>
	</div>

{% endblock %}
{% block js %}
	{{ parent() }}
	<script src="{{ asset('/js/modal.js') }}?v={{ random() }}"></script>
{% endblock %}
